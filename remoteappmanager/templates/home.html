{% extends "base.html" %}

{% block body %}
    <noscript>
        <div id='noscript'>
            Jupyter Hub requires JavaScript.<br>
            Please enable it to proceed.
        </div>
    </noscript>

    <div class="wrapper">

        <!-- Main Header -->
        <header class="main-header">

            <a href="#" class="logo">
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg"><b>Simphony</b>Remote</span>
            </a>

        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top" role="navigation">
            <!-- Navbar Right Menu -->
            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">

                    <!-- User Account Menu -->
                    <li class="dropdown user user-menu">
                        <!-- Menu Toggle Button -->
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <!-- The user image in the navbar-->
                            <img src="https://www.gravatar.com/avatar/{{ user.name | gravatar_id }}" class="user-image" alt="User Image">
                            <!-- hidden-xs hides the username on small devices so only the image appears. -->
                            <span class="hidden-xs">{{ user.name }}</span>
                        </a>
                        <ul class="dropdown-menu">
                            <!-- The user image in the menu -->
                            <li class="user-header">
                                <img src="https://www.gravatar.com/avatar/{{ user.name | gravatar_id }}" class="img-circle" alt="User Image">
                                <p>{{ user.name }}</p>
                            </li>
                            <!-- Menu Body -->
                            <li class="user-body"></li>

                            <!-- Menu Footer-->
                            <li class="user-footer">
                                <div class="pull-right">
                                    {% block login_widget %}
                                        <a id="logout" href="{{ logout_url }}" class="btn btn-default btn-flat">
                                            <i class="fa fa-sign-out"> Sign out</i>
                                        </a>
                                    {% endblock %}
                                </div>
                            </li>
                        </ul>
                    </li>
                    <!-- Control Sidebar Toggle Button -->
                </ul>
            </div>
        </nav>
        </header>

        <div id="ember_container"></div>

        {% raw %}
        <!-- Ember template for the Application list -->
        <script type="text/x-handlebars" data-template-name="application">

            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">

                    <!-- search form (Optional) -->
                    <form action="#" method="get" class="sidebar-form">
                        <div class="input-group">
                            <input type="text" name="q" class="form-control" placeholder="Search...">
                            <span class="input-group-btn">
                                <button type="submit" name="search" id="search-btn" class="btn btn-flat">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                        </div>
                    </form>

                    <!-- /.search form -->

                    <!-- Sidebar Menu -->
                    <ul class="sidebar-menu">
                        <li class="header">APPLICATIONS</li>
                    </ul>

                    {{
                        application-list
                        class="sidebar-menu"
                        id="applist"
                        update_current_app=(action "toggle_app_selected")
                    }}

                    <!-- /.sidebar-menu -->
                </section>
                <!-- /.sidebar -->
            </aside>

            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                <!-- Main content -->
                {{#if (not-null current_application)}}
                    {{
                        application-view
                        application=current_application
                    }}
                {{/if}}
                <!-- /.content -->
            </div>
            <!-- /.content-wrapper -->

        </script>

        <script type="text/x-handlebars" data-template-name="components/application-list">
            <!-- Loading icon -->
            {{#if list_loading}}
                <li>
                    <a href="#">
                        <i class="fa fa-spinner fa-spin"></i>
                        <span>Loading</span>
                    </a>
                </li>
            {{/if}}

            {{#if empty_list}}
                <li>
                    <a href="#">No applications found</a>
                </li>
            {{/if}}

            <!-- Application list -->
            {{#each application_entry_list as |application index|}}
                <li onclick={{action "toggle_app_clicked" index}}
                    data-index="{{index}}"
                    class="{{ if (equal selected_app index) 'active' }}">

                    <span class="{{application.status}}-badge"></span>

                    <a href="#" class="truncate">

                        <img src="{{icon_src application.app_data}}" class="app-icon">

                        {{#if (is-running application.status)}}
                            <button class="stop-button"
                                    data-index="{{index}}"
                                    onclick={{action "toggle_app_stopped" application}}>
                                <i class="fa fa-times"></i>
                            </button>
                        {{/if}}

                        <span>{{app_name application.app_data}}</span>

                    </a>
                </li>
            {{/each}}
        </script>

        <script type="text/x-handlebars" data-template-name="components/application-view">
            <!-- Start application form -->
            {{#if (or (is-stopped application.status)(is-starting application.status))}}
                 <div class="row">
                     <div class="col-md-offset-2 col-md-8">
                         <div class="box box-primary">
                             <div class="box-header with-border">
                                 <h3 class="box-title">
                                     {{app_name application.app_data}}
                                 </h3>
                                 <div class="box-tools pull-right"></div>
                             </div>
                             <div class="box-body">
                                 <h4>Policy</h4>
                                 <ul class="policy">
                                     <li> Workspace {{ unless application.app_data.image.policy.allow_home 'not' }} accessible </li>
                                     {{#if (and application.app_data.image.policy.volume_source application.app_data.image.policy.volume_target application.app_data.image.policy.volume_mode)}}
                                        <li>
                                            Volume mounted: {{application.app_data.image.policy.volume_source}} &#x2192; {{application.app_data.image.policy.volume_target}} ({{application.app_data.image.policy.volume_mode}})
                                        </li>
                                     {{else}}
                                        <li> No volumes mounted </li>
                                     {{/if}}
                                 </ul>
                                 <h4>Configuration</h4>
                                 <form class="configuration">
                                     <fieldset disabled={{ if (is-starting application.status) true }}>
                                         <div class="form-group">
                                             <label>Resolution</label>
                                             <select class="form-control" onchange={{action "toggle_resolution_changed"}}>
                                                 {{#each resolution_options as |resolution|}}
                                                    <option value="{{resolution}}">{{resolution}}</option>
                                                 {{/each}}
                                             </select>
                                         </div>
                                     </fieldset>
                                 </form>
                             </div>
                             <div class="box-footer">
                                 <button
                                         onclick={{action "start_application"}}
                                         class="btn btn-primary pull-right start-button"
                                         disabled={{ if (is-starting application.status) true }}>
                                     Start
                                 </button>
                             </div>
                         </div>
                     </div>
                 </div>
            {{else}}

            <!-- Application view -->
                <iframe
                        id="application"
                        frameBorder="0"
                        src="{{ application_location }}"
                        style="min-width: {{ width }}px; min-height: {{ height }}px;">
                </iframe>
            {{/if}}
        </script>
        {% endraw %}

    </div>

    {% block dialogs %}
        {% call macros.modal_dlg('Error', btn_label='OK') %}
            <div class="error-msg">
                The error
            </div>
        {% endcall %}
    {% endblock %}
{% endblock %}

{% block script_init %}
    {{  super() }}
    <script type="text/javascript">
        window.AdminLTEJavascriptPath = "{{ static_url("components/admin-lte/dist/js/app.min.js") }}";
        require(["home/controller"]);
    </script>

    <script src="{{ static_url("components/admin-lte/plugins/jQuery/jquery-2.2.3.min.js") }}"></script>
    <script src="{{ static_url("components/admin-lte/bootstrap/js/bootstrap.min.js") }}"></script>
{% endblock %}
